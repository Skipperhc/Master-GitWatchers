<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
<meta charset="UTF-8">
<title>GitWatchers</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
	crossorigin="anonymous">

<style>
body {
	background-color: white;
	text-align: center;
	color: black;
	font-family: Arial, Helvetica, sans-serif;
}
</style>

<script src="https://www.google.com/jsapi"></script>

<script type="text/javascript" th:inline="javascript"> 

        // Load the Visualization API and the corechart package.
        google.charts.load('current', {'packages':['corechart']});

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart() {

            // Create the data table.
/*             var data = new google.visualization.DataTable();
            data.addColumn('string', 'Topping');
            data.addColumn('number', 'Slices');
            data.addRows([[${chartData}]]); 
*/
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Topping');
            data.addColumn('number', 'Slices');
            data.addRows([
                /*[# th:each="row : ${chartData}"]*/
                [[${row}]],
                /*[/]*/
            ]);
            
            // Set chart options
            var options = {'title':'Porcentagem de repositorio por linguagens',
                'width':400,
                'height':300};

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
    </script>

</head>
<body th:erroFuncao="${errorMessage}" th:onload="SweetAlertErro()">


	<div th:replace="base/layout :: navbar"></div>

	<br>
	<div class="d-flex justify-content-center">
		<form action="/index" method="get">
			<div class="row form-group">
				<label for="nome">Usuário</label> <input name="user"
					class="form-control" />
			</div>

			<br>

			<div class="row form-group">
				<div>
					<button type="submit" class="btn btn-success">Buscar</button>
				</div>
			</div>

		</form>
	</div>

	<br>

	<span
		th:text="${listaPorcentagens != null} ? ${listaPorcentagens[0].usuario} : ''"></span>


	<div class="d-flex justify-content-center">
		<table>
			<th:block th:each="porcentagem : ${listaPorcentagens}">
				<tr>
					<!-- 				<td th:text="${porcentagem}">...</td> -->
					<td th:text="'Linguagem: ' + ${porcentagem?.linguagem + ' &nbsp;'}">...</td>
					<td
						th:text="' Quantidade de Repositorios: ' + ${porcentagem?.qtd + ' &nbsp;'}">...</td>
					<td th:text="' Porcentagem: ' +  ${porcentagem?.porcentagem} + '%'">...</td>
				</tr>
			</th:block>
		</table>
	</div>
	
<!-- 	<button class="btn btn-danger navbar-btn"
		onclick="drawChart(new google.visualization.PieChart(document.getElementById('chart_div')))">Button</button>
		th:attr="onclick=|SweetAlertErro('Atenção','${errorMessage}')|"
 -->
	<div class="d-flex justify-content-center">
		<div id="chart_div"></div>
	</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js" integrity="sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA==" crossorigin="anonymous"></script>
	
	<script type="text/javascript">
		function isEmpty(str) {
		    return (!str || 0 === str.length);
		}	
	
		function SweetAlertErro()
		{	
			var erro = document.querySelectorAll('body')[0].getAttribute('erroFuncao');
			
			if(isEmpty(erro) == false)
			{	
				swal({
					  title: 'Atenção',
					  text: erro,
					  icon: "error",
					  dangerMode: false,
					});
			}
		}
		
		function SweetAlertSucesso(titulo,textoConteudo)
		{	
			swal({
				  title: titulo,
				  text: textoConteudo,
				  icon: "success",
				  dangerMode: false,
				});
		}
		
	</script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
		crossorigin="anonymous"></script>
</body>
</html>